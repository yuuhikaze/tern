import { GroupBox, TabWidget, ListView, TextEdit, Button, ComboBox, LineEdit, AboutSlint } from "std-widgets.slint";
import { Backend } from "../backend.slint";

component ConversionEngine inherits GroupBox {
    title: "Conversion engine";
    property <[string]> engines: Backend.engines;
    property <bool> save-signal: Backend.save-signal;
    changed save-signal => {
        Backend.engine = combo.current-value;
    }
    combo := ComboBox {
        model: engines;
    }
}

component IOKind inherits GroupBox {
    property <bool> clear-signal: Backend.clear-signal;
    out property <string> path: path.text;
    out property <string> extension: extension.text;
    changed clear-signal => {
        path.text = "";
        extension.text = "";
    }
    in property <string> kind;
    VerticalLayout {
        HorizontalLayout {
            path := LineEdit {
                placeholder-text: "Relative path";
            }

            Button {
                text: "";
            }
        }

        extension := LineEdit {
            placeholder-text: "File extension";
        }
    }
}

component Source inherits IOKind {
    title: "Source";
    property <bool> save-signal: Backend.save-signal;
    changed save-signal => {
        Backend.source-path = root.path;
        Backend.source-file-extension = root.extension;
    }
}

component Output inherits IOKind {
    title: "Output";
    property <bool> save-signal: Backend.save-signal;
    changed save-signal => {
        Backend.output-path = root.path;
        Backend.output-file-extension = root.extension;
    }
}

component ConversionEngineSettings inherits GroupBox {
    title: "Conversion engine settings";
    TabWidget {
        Tab {
            title: "Options";
            HorizontalLayout {
                property <bool> save-signal: Backend.save-signal;
                changed save-signal => {
                    Backend.options = options.text;
                }
                options := TextEdit { } // TODO: change for a more adhoc widget
            }
        }

        Tab {
            title: "Ignore patterns";
            HorizontalLayout {
                property <bool> save-signal: Backend.save-signal;
                changed save-signal => {
                    Backend.ignore-patterns = ignore-patterns.text;
                }
                ignore-patterns := TextEdit { }
            }
        }
    }
}

component Toolbar inherits GroupBox {
    HorizontalLayout {
        alignment: end;
        popup := PopupWindow {
            AboutSlint { }
        }

        Button {
            horizontal-stretch: 0;
            text: "";
            clicked => {
                popup.show();
            }
        }

        Rectangle {
            width: 10px;
        }

        Button {
            horizontal-stretch: 0;
            text: "";
            clicked => {
                Backend.save-profile();
            }
        }

        Button {
            horizontal-stretch: 0;
            text: "";
        }
    }
}

export component RightPanel inherits VerticalLayout {
    ConversionEngine { }

    Source { }

    Output { }

    ConversionEngineSettings { }

    Toolbar { }
}
